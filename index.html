<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BET300 ¬∑ Especial Navidad</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050818;
  --panel:#0b1024;
  --border:#1f2750;
  --text:#f9fbff;
  --muted:#adb5da;
  --gold:#facc15;
  --wa:#25D366;
  --cta:#38bdf8;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:"Montserrat",system-ui;
  background:radial-gradient(circle at top,#111827 0,#020617 60%);
  color:var(--text);
  overflow-x:hidden;
}

/* ===== Nieve ===== */
.snow{position:fixed;inset:0;pointer-events:none;z-index:1}
.snow i{
  position:absolute;
  top:-10px;
  width:6px;height:6px;
  background:white;
  border-radius:50%;
  opacity:.8;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh)}
}

/* ===== Header ===== */
.header{
  text-align:center;
  padding:18px 16px 6px;
}
.header img{
  height:56px;
  width:auto;
  filter:drop-shadow(0 4px 14px rgba(0,0,0,.7));
}
.header .season{
  margin-top:6px;
  font-size:12px;
  letter-spacing:.28em;
  text-transform:uppercase;
  color:var(--gold);
}

/* ===== Layout ===== */
.container{max-width:960px;margin:auto;padding:0 16px 120px}

.hero{
  background:linear-gradient(145deg,#0f172a,#1e40af);
  border-radius:18px;
  padding:18px;
  border:1px solid rgba(148,163,184,.35);
  margin-bottom:20px;
}
.hero h1{
  font-size:18px; /* un poquito m√°s chico */
  font-weight:800;
}
.hero p{
  margin-top:8px;
  font-size:14px;
  color:var(--muted);
}

/* ===== Gifts ===== */
.gift-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
  margin-top:18px;
}
@media(max-width:720px){
  .gift-grid{grid-template-columns:1fr}
}

.gift{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  text-align:center;
  cursor:pointer;
  position:relative;
  transition:.25s;
}
.gift.disabled{opacity:.55;filter:grayscale(1);pointer-events:none}

.gift-box{
  width:92px;height:70px;
  margin:8px auto 12px;
  background:linear-gradient(145deg,#b91c1c,#7f1d1d);
  border-radius:10px;
  position:relative;
}
.ribbon-v{
  position:absolute;left:50%;top:0;
  width:14px;height:100%;
  transform:translateX(-50%);
  background:linear-gradient(#fde68a,#facc15,#ca8a04);
}
.ribbon-h{
  position:absolute;left:0;top:28px;
  width:100%;height:12px;
  background:linear-gradient(#fde68a,#facc15,#ca8a04);
}

.gift-label{
  font-size:12px;
  font-weight:700;
  color:var(--gold);
  margin-bottom:2px;
}

/* por defecto oculto el resultado */
.gift-result{display:none;margin-top:10px;color:var(--text)}
.gift.open .gift-result{display:block}

/* en los no elegidos, queremos mostrar ‚ÄúHab√≠a:‚Äù */
.gift.show-other .gift-result{display:block}
.gift-result small{color:var(--muted);font-weight:700}

.btn-wa{
  margin-top:10px;
  width:100%;
  padding:10px;
  border-radius:999px;
  border:none;
  background:var(--wa);
  color:#022c22;
  font-weight:900;
  cursor:pointer;
}

/* ===== Actions below gifts ===== */
.actions{
  margin-top:18px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}
.btn-action{
  border:none;
  cursor:pointer;
  padding:12px 16px;
  border-radius:14px;
  font-weight:900;
  background:rgba(255,255,255,.08);
  color:var(--text);
  border:1px solid rgba(148,163,184,.25);
}
.btn-action.primary{
  background:linear-gradient(90deg,#38bdf8,#0ea5e9);
  color:#020617;
  border:none;
}

/* ===== Modal ===== */
.modal{
  position:fixed;inset:0;
  background:rgba(2,6,23,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.modal.show{display:flex}
.modal-card{
  background:#020617;
  border-radius:18px;
  padding:22px;
  width:92%;
  max-width:390px;
  text-align:center;
  border:1px solid rgba(148,163,184,.35);
  box-shadow:0 25px 60px rgba(0,0,0,.55);
}
.modal-card h2{font-size:22px;margin-bottom:6px}
.modal-card .sub{font-size:13px;color:var(--muted);margin-bottom:10px;line-height:1.35}
.modal-card .code{
  margin:10px 0 8px;
  padding:10px;
  background:#0f172a;
  color:var(--gold);
  border-radius:10px;
  font-weight:900;
  letter-spacing:.08em;
}
.modal-card .ts{
  font-size:12px;
  color:var(--muted);
  margin-bottom:12px;
}
.modal-card .btn-modal-wa{
  width:100%;
  padding:10px;
  border-radius:999px;
  border:none;
  background:var(--wa);
  color:#022c22;
  font-weight:900;
  cursor:pointer;
  margin-top:10px;
}
.modal-card .btn-close{
  margin-top:10px;
  width:100%;
  padding:10px;
  border-radius:999px;
  border:none;
  background:var(--cta);
  color:#020617;
  font-weight:900;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="snow" id="snow"></div>

<header class="header">
  <img src="logo-bet300.svg" alt="BET300">
  <div class="season">Especial Navidad</div>
</header>

<div class="container">

<section class="hero">
  <h1>Eleg√≠ tu regalo üéÅ</h1>
  <p>Ten√©s una sola oportunidad. Abr√≠ un regalo y descubr√≠ tu premio.</p>
</section>

<div class="gift-grid" id="gifts"></div>

<div class="actions">
  <button class="btn-action" id="tryAgainBtn">üéÅ Tirar nuevamente</button>
  <button class="btn-action primary" id="openPlatformBtn">üéÆ Ir a la plataforma</button>
</div>

</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-card">
    <h2 id="modalTitle">üéâ Premio obtenido</h2>
    <div class="sub" id="modalPrize">‚Äî</div>
    <div class="code" id="modalCode">‚Äî</div>
    <div class="ts" id="modalTS">‚Äî</div>
    <button class="btn-modal-wa" id="modalWaBtn">üì≤ Reclamar por WhatsApp</button>
    <button class="btn-close" id="modalCloseBtn">Cerrar</button>
  </div>
</div>

<script>
/* =======================
   NIEVE
======================= */
const snow=document.getElementById("snow");
for(let i=0;i<42;i++){
  const f=document.createElement("i");
  f.style.left=Math.random()*100+"vw";
  f.style.animationDuration=(6+Math.random()*6)+"s";
  f.style.opacity=(0.35+Math.random()*0.65);
  f.style.transform=`translateY(${Math.random()*-120}px)`;
  snow.appendChild(f);
}

/* =======================
   PARAMETRO pc (1..5)
======================= */
const pc = new URLSearchParams(location.search).get("pc") || "1";

/* üëâ CAMBI√Å ESTOS NUMEROS */
const WP_BY_PC = {
  1:"5491150030414",
  2:"5491150030414",
  3:"5491150030414",
  4:"5491150030414",
  5:"5491150030414"
};
const WP = WP_BY_PC[pc] || WP_BY_PC[1];

/* =======================
   PROMOS
======================= */
const PROMOS = [
  "Bono 10%",
  "Bono 20%",
  "Bono 30%",
  "$5.000 extra",
  "$10.000 extra",
  "Doble carga"
];

/* =======================
   UI refs
======================= */
const giftsEl = document.getElementById("gifts");
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalPrize = document.getElementById("modalPrize");
const modalCode = document.getElementById("modalCode");
const modalTS = document.getElementById("modalTS");
const modalWaBtn = document.getElementById("modalWaBtn");
const modalCloseBtn = document.getElementById("modalCloseBtn");

const tryAgainBtn = document.getElementById("tryAgainBtn");
const openPlatformBtn = document.getElementById("openPlatformBtn");

/* =======================
   helpers
======================= */
function tsString(d=new Date()){
  const dd=String(d.getDate()).padStart(2,'0');
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const yyyy=d.getFullYear();
  const hh=String(d.getHours()).padStart(2,'0');
  const mi=String(d.getMinutes()).padStart(2,'0');
  return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
}
function antifraud(){
  return "XMAS-" + Math.random().toString(36).slice(2,8).toUpperCase();
}
function alreadyUsedMsg(){
  alert("‚ö†Ô∏è Ya usaste tu chance de hoy. Volv√© ma√±ana para otra oportunidad üéÅ");
}
function openPlatform(){
  window.open("https://www.bet300.biz/", "_blank", "noopener");
}
function closeModal(){
  modal.classList.remove("show");
}

/* =======================
   storage
======================= */
let used = localStorage.getItem("xmas_used") === "1";
let savedPrize = localStorage.getItem("xmas_prize");
let savedCode  = localStorage.getItem("xmas_code");
let savedTS    = localStorage.getItem("xmas_ts");
let savedOthers = null;
try { savedOthers = JSON.parse(localStorage.getItem("xmas_others") || "null"); } catch(e){ savedOthers=null; }

/* =======================
   Buttons
======================= */
openPlatformBtn.addEventListener("click", openPlatform);

tryAgainBtn.addEventListener("click", ()=>{
  if(used) return alreadyUsedMsg();
  alert("üéÅ Todav√≠a no elegiste ning√∫n regalo. Abr√≠ uno de los cofres.");
});

modalCloseBtn.addEventListener("click", closeModal);

/* =======================
   WhatsApp message
======================= */
function buildWaMsg(prize, code, ts){
  return `Hola, gan√© *${prize}* en la promo Navidad üéÑ
C√≥digo: ${code}
Fecha/Hora: ${ts}
PC: ${pc}

Quiero reclamarlo con mi pr√≥xima carga.`;
}
function goWA(prize, code, ts){
  const msg = buildWaMsg(prize, code, ts);
  location.href = `https://wa.me/${WP}?text=${encodeURIComponent(msg)}`;
}

/* =======================
   Render gifts
======================= */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function makeGiftCard(prizeText){
  const d=document.createElement("div");
  d.className="gift";
  d.dataset.prize = prizeText;

  d.innerHTML=`
    <div class="gift-label">Regalo sorpresa</div>
    <div class="gift-box">
      <div class="ribbon-v"></div>
      <div class="ribbon-h"></div>
    </div>
    <div class="gift-result">
      <strong>${prizeText}</strong>
      <button class="btn-wa" type="button">Reclamar por WhatsApp</button>
    </div>
  `;
  return d;
}

/* =======================
   Apply "chosen" state
======================= */
function applyChosenState(chosenPrize, code, ts, allSelected, chosenIndex){
  const all = document.querySelectorAll(".gift");

  // 1) En todos: mostrar qu√© hab√≠a, sin bot√≥n
  all.forEach((g, idx)=>{
    const prize = g.dataset.prize;
    g.classList.add("disabled");
    g.classList.remove("open");
    g.classList.add("show-other");            // fuerza mostrar gift-result
    g.querySelector(".gift-label").textContent = "No elegido";

    const res = g.querySelector(".gift-result");
    res.innerHTML = `<small>Hab√≠a:</small><br><strong>${prize}</strong>`;
  });

  // 2) En el elegido: abrir + bot√≥n WA
  const chosenCard = all[chosenIndex] || all[0];
  chosenCard.classList.remove("disabled");
  chosenCard.classList.add("open");
  chosenCard.classList.remove("show-other");
  chosenCard.querySelector(".gift-label").textContent = "üéâ Tu premio";

  const chosenRes = chosenCard.querySelector(".gift-result");
  chosenRes.innerHTML = `
    <strong>${chosenPrize}</strong>
    <button class="btn-wa" type="button">üì≤ Reclamar por WhatsApp</button>
  `;
  chosenRes.querySelector(".btn-wa").onclick = (ev)=>{
    ev.stopPropagation();
    goWA(chosenPrize, code, ts);
  };

  // 3) Modal WA
  modalWaBtn.onclick = ()=> goWA(chosenPrize, code, ts);
}

/* =======================
   Init
======================= */
function init(){
  // Si ya us√≥ hoy: reconstruir con premios visibles
  if(used && savedPrize && savedCode && savedTS && Array.isArray(savedOthers) && savedOthers.length === 3){
    giftsEl.innerHTML = "";
    savedOthers.forEach(p=>{
      const card = makeGiftCard(p);
      // si llega a verse, que no navegue
      card.onclick = alreadyUsedMsg;
      giftsEl.appendChild(card);
    });

    // Elegimos mostrar el premio ganado en el primer cofre para consistencia visual:
    const chosenIndex = savedOthers.indexOf(savedPrize) >= 0 ? savedOthers.indexOf(savedPrize) : 0;

    applyChosenState(savedPrize, savedCode, savedTS, savedOthers, chosenIndex);

    // modal no se abre solo, pero queda listo
    return;
  }

  // Si no us√≥: crear 3 premios random
  const selected = shuffle(PROMOS).slice(0,3);

  giftsEl.innerHTML = "";
  selected.forEach((p, idx)=>{
    const card = makeGiftCard(p);

    // antes de elegir, ocultar resultado
    card.classList.remove("open");
    card.querySelector(".gift-result").style.display = "none";

    // click en cofre
    card.addEventListener("click", ()=>{
      if(used) return alreadyUsedMsg();

      // marcar usado
      used = true;
      localStorage.setItem("xmas_used","1");

      const code = antifraud();
      const ts = tsString(new Date());

      localStorage.setItem("xmas_prize", p);
      localStorage.setItem("xmas_code", code);
      localStorage.setItem("xmas_ts", ts);
      localStorage.setItem("xmas_others", JSON.stringify(selected));

      // set saved vars (por si)
      savedPrize = p; savedCode = code; savedTS = ts; savedOthers = selected;

      // aplicar UI final (con premios restantes visibles)
      applyChosenState(p, code, ts, selected, idx);

      // abrir modal
      modalTitle.textContent = "üéâ Premio obtenido";
      modalPrize.textContent = `Premio: ${p} ¬∑ PC ${pc}`;
      modalCode.textContent = code;
      modalTS.textContent = `üïí ${ts}`;
      modal.classList.add("show");
    });

    giftsEl.appendChild(card);
  });
}

init();
</script>

</body>
</html>
